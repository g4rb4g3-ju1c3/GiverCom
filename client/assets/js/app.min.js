const t=1===$("meta[name=app_env_development]").length,e=8,n=9,s=13,i=16,o=17,a=18,r=19,c=20,l=27,u=46,d=112,m=113,g=114,f=115,p=116,_=117,h=118,b=119,w=120,v=121,y=122,k=123,j=144,x=145,S=1,C=2,N=3,T=500,O="0123456789ABCDEF",I="0123456789ABCDEF#",W=1,E=0;function M(){return window.getSelection?window.getSelection().getRangeAt(0):document.selection?document.selection.createRange():void 0}function A(t,e){if(null!=Ss){var n=window.getSelection();n?(n.rangeCount>0&&n.removeAllRanges(),n.addRange(e)):document.createRange?n.addRange(e):document.selection&&e.select()}}function L(t,e){"number"!=typeof e&&(e=T),t.target.longclick=!1,bn=setTimeout(function(){const e=new Event("longclick");e.which=t.which,bn=null,t.target.longclick=!0,t.target.dispatchEvent(e)},e)}function H(){return!bn||(clearTimeout(bn),bn=null,!1)}function U(){return P([1e7]+-1e3+-4e3+-8e3+-1e11)}function G(){return P([1e7]+1e3+4e3+8e3+1e11)}function P(t){return t.replace(/[018]/g,function(t){return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)})}function R(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(e),o=new Uint8Array(n.length),s=0;s<n.length;s++)o[s]=n.charCodeAt(s);return o}const D={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function J(t){return"string"!=typeof t?t:t.replace(/[&<>"'`=\/]/g,function(t){return D[t]})}function F(t){return"string"!=typeof t?t:t.replace(/(https?:\/\/[^\s^<]+)/g,function(t){return'<a href="'+t+'" target="_blank">'+t+"</a>"}).replace(/(magnet:[^\s^<]+)/g,function(t){return'<a href="'+t+'">'+t+"</a>"})}function Y(t){function e(t){return"\\u"+t.toString(16).toUpperCase()}return t<=65535?e(t):e(55296+((t-=65536)>>10))+e(56320+(t&parseInt("1111111111",2)))}function K(t){return t<=65535?String.fromCodePoint(t):(t-=65536,String.fromCodePoint(55296+(t>>10))+String.fromCodePoint(56320+(t&parseInt("1111111111",2))))}function Vi(){const t=document.createElement("div");t.style.visibility="hidden",t.style.overflow="scroll",t.style.msOverflowStyle="scrollbar",document.body.appendChild(t);const e=document.createElement("div");t.appendChild(e);const n=t.offsetWidth-e.offsetWidth;return t.parentNode.removeChild(t),n}const V=!0,B={NONE:0,INIT:1,SW:2,WS:4,LOGIN:8,USER:16,CNV:32,MSG:64,UPLOAD:128,UI:256,ALL:65535},q=B.INIT|B.SW|B.WS|B.ALL|B.NONE,z="YYYY-MM-DD HH:mm:ss.SSS",Q=30,X=new Array(Q+1).join(" ");var Z=!0;function tt(e,n,o){void 0===o&&(st("applog","log_flags undefined"),o=B.ALL),"number"==typeof o&&(t||V)&&o&q&&(n=at(e,n),console.log(n),$("#log_viewer_content").append(n+"\n"))}function et(e){(t||V)&&(console.log(e),$("#log_viewer_content").append(e+"\n"))}function nt(e,n){(t||V)&&(void 0===n&&(n=e,e=""),n=at(e,n),console.info(n),$("#log_viewer_content").append(n+"\n"))}function st(e,n){(t||V)&&(void 0===n&&(n=e,e=""),n=at(e,n),console.warn(n),$("#log_viewer_content").append(n+"\n"))}function it(e,n){(t||V)&&(void 0===n&&(n=e,e=""),n=at(e,n),console.error(n),$("#log_viewer_content").append(n+"\n"))}function ot(e,n){(t||V)&&(void 0===n&&(n=e,e=""),console.dir(n),$("#log_viewer_content").append(at(e,JSON.stringify(n))+"\n"))}function at(t,e){return"string"!=typeof t&&(t=""),e=void 0===e?"":""+e,(moment().format(z)+"   "+(t+X).substring(0,Q)+e).trim()}function rt(){qe($("#log_viewer_content"),{fullwidth:!0,fullheight:!0,init_visible:function(t){$dialog_message=t.find(".dialog-message"),$log_viewer=t.find("#log_viewer_content"),$dialog_message.scrollTop($dialog_message.outerHeight()),Ut.on("scroll",function(t){t.stopPropagation(),Z=$dialog_message.scrollTop()>=Math.floor($log_viewer.height()-$dialog_message.height()-10)})},close_button:!0,default_button:"close_button",escape_button:"close_button"})}function ct(){$dialog_message.scrollTop($dialog_message.outerHeight())}var lt=0;function ut(t){console.log(void 0!==t?t:"nigs")}function dt(t){console.log(lt+++": "+(void 0!==t?t:"nigs"))}function mt(){lt=0}function gt(t){alert(void 0!==t?t:"nigs")}function ft(){console.log("nigs")}console.log(),nt("10-app.js","APP_ENV_DEVELOPMENT: "+t,B.INIT),nt("10-app.js","navigator.userAgent: "+navigator.userAgent,B.INIT),nt("10-app.js","window.location:     "+window.location,B.INIT),nt("10-app.js","window.navigator.onLine: "+navigator.onLine,B.INIT),app={},app.support={},app.support.touch="ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0,app.support.filereader="File"in window&&"FileReader"in window&&"FileList"in window&&"Blob"in window,app.support.notifications="Notification"in window,app.support.serviceworker="serviceWorker"in navigator,app.support.pushmanager="PushManager"in window,app.support.websocket="WebSocket"in window,nt("10-app.js","app.support: "+JSON.stringify(app.support),B.INIT),app.info={},app.info.name=$("meta[name=app_name]").attr("content"),app.info.version=$("meta[name=app_version]").attr("content"),app.info.author=$("meta[name=app_author]").attr("content"),app.info.copyright=$("meta[name=app_copyright]").attr("content"),app.info.description=$("meta[name=app_description]").attr("content"),app.info.device_type=$("meta[name=app_device_type]").attr("content"),app.info.touch_device=app.support.touch,nt("10-app.js","app.info: "+JSON.stringify(app.info),B.INIT),console.log(),app.support.websocket||alert("You need a browser that supports WebSockets.\n\nIt's "+(new Date).getFullYear()+".  They're not hard to find.  I'm not even sure how you found one that doesn't.");const pt="desktop",_t="android",ht="bb10",bt=100,wt=5,vt=15,yt=30,kt=60,$t=1e3,jt=2500,xt=750,vi=5e3,St="msg_notification_test",Ct="msg_notification_cnv_",Ui=.9;var Nt=$(window),Tt=$(document),Ot=null,It=null,Wt=null,Et=null,Ri=null,Mt=null,At=null,Lt=null,Ht=null,Ut=null,Gt=null,Pt=null,Rt=null,Dt=null,Jt=null,Ft=null,Yt=null,Vt=null,Ki=null,Kt=null,Bt=null,qt=null,zt=null,Qt=null,Xt=null,Zt=null,te=null,ee=null,ne=null,se=null,ie=null,oe=!1;Tt.ready(function(){Ot=$(document.body),It=$("#load_indicator"),Wt=$("#page_cover"),Et=$("#header"),Ri=$("#previewbar"),Mt=$("#header #titlebar"),At=$("#header #titlebar_min"),Lt=$("#hamburger_menu"),$content_scroll=$("#content_scroll"),Ut=$("#content"),Gt=$("#content_holding"),Pt=$("#welcome"),Rt=$("#conversation"),Ht=$("#footer"),Yt=$("#footer #attachmentbar"),Vt=$("#footer #emojibar"),Ki=$("#available_emojis"),Dt=$("#footer #msgbufferbar"),Jt=$("#footer #inputbar"),Ft=$("#footer #inputbar #attachment_button"),Kt=$("#footer #inputbar #emoji_button"),Bt=$("#footer #inputbar #msg_body_input"),qt=$("#footer #typing_indicator"),zt=$("#footer #inputbar #send_button"),Qt=$("#templates .date-header"),Xt=$("#templates .message-group"),Zt=$("#templates .message"),te=$("#templates .media-container"),$dialogbox_template=$("#templates .dialogbox"),ne=$("#app_login"),se=$("#app_settings"),ie=$("#app_about")});var ae=null;function re(){tt("app_install_prompt","",B.INIT),ae.prompt(),ae.userChoice.then(function(t){"accepted"===t.outcome?tt("app_install_prompt","User accepted the install prompt"):tt("app_install_prompt","User dismissed the install prompt"),ae=null})}function ce(t){return app.info.device_type===t}function le(){Re.emit("app_stats",function(t){ze('<b>Messages in this conversation</b><br>You: <span id="stats_msgs_user_cnv"></span><br>Them: <span id="stats_msgs_other_cnv"></span><br>Total: <span id="stats_msgs_cnv"></span><br><hr><b>Your messages</b><br>Total: <span id="stats_msgs_user_total"></span><br>',{init:function(e){$("#stats_msgs_user_cnv").html(t.msgs_user_cnv),$("#stats_msgs_other_cnv").html(t.msgs_cnv-t.msgs_user_cnv),$("#stats_msgs_cnv").html(t.msgs_cnv),$("#stats_msgs_user_total").html(t.msgs_user_total)},close_button:!0,default_button:"close_button",escape_button:"close_button"})})}function ue(){var t="";for(var e in t="<table>",Ys)t+='<tr><td class="hpad">'+e+'</td><td class="hpad">'+Ys[e]+"</td></tr>";ze(t+="</table>",{close_button:!0,default_button:"close_button",escape_button:"close_button"})}function de(){qe(ie,{fullwidth:!0,fullheight:!0,close_button:!0,default_button:"close_button",escape_button:"close_button"})}function me(t,e){return"media?f="+t+(e?"&t="+e:"")}function ge(){tt("app_update_push_sub","",B.SW),app.support.serviceworker&&Re.connected&&app.push_sub&&Re.emit("app_update_push_sub",app.push_sub)}function fe(t){app.support.serviceworker&&navigator.serviceWorker.controller&&ns&&navigator.serviceWorker.controller.postMessage(JSON.stringify(t))}function pe(){ns&&fe({msg:"user_settings",user:ns})}Nt.on("beforeinstallprompt",function(t){return tt("window.beforeinstallprompt","",B.INIT),ae=t.originalEvent,$("#hamburger_menu_install").removeClass("hidden"),!1}),Nt.on("appinstalled",function(t){tt("window.appinstalled","",B.INIT),$("#hamburger_menu_install").remove()}),force_subscription=!1,app.support.serviceworker&&app.support.pushmanager?(tt("navigator.sw.register",t?"sw.js":"sw.min.js",B.SW),navigator.serviceWorker.register(t?"sw.js":"sw.min.js",{scope:"./"}).then(function(t){tt("navigator.sw.register","Scope: "+t.scope,B.SW),t.installing?tt("navigator.sw.register","installing",B.SW):t.waiting?tt("navigator.sw.register","installed",B.SW):t.active&&tt("navigator.sw.register","active",B.SW),t.pushManager.getSubscription().then(function(e){!force_subscription&&e?app.push_sub=e:fetch("vpk").then(function(n){n.text().then(function(n){e=t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:R(n)}).then(function(t){app.push_sub=t}).catch(function(t){st("navigator.sw.register","pushManager.getSubscription: subscribe failed: "+t,B.SW)})})}).catch(function(t){st("navigator.sw.register","pushManager.getSubscription: fetch failed: "+t,B.SW)})}).catch(function(t){st("navigator.sw.register","pushManager.getSubscription failed: "+t,B.SW)}),navigator.serviceWorker.addEventListener("message",function(t){switch(tt("navigator.sw.message",JSON.stringify(t.data),B.SW),t.data.msg){case"msg_clear_new_msg_indicator":Yn();break;case"share_incoming":break;case"notification_click_babygoats":li()}})}).catch(function(t){st("11-sw.js","navigator.sw.register failed: "+t,B.SW)})):st("11-sw.js","ServiceWorker not supported");const _e=1e3,he=15e3,be=1e3,we=15e3,ve=1e4,ye=1e3,ke=1001,$e=1002,je=1003,xe=1004,Se=1005,Ce=1006,Ne=1007,Te=1008,Oe=1009,Ie=1010,We=1011,Ee=1015,Me=4e3,Ae=4403,Le=4500,He=4900,Ue=4901,Ge=4904,Pe=4905,Re={listeners:{},ws:null,ws_sockets:{},new_socket_id:0,connected:!1,net_timer:null,xhr_reconnect:null};function De(t,e){if("string"==typeof t&&""!==t){if(Re.listeners[t])if(void 0===e)Re.listeners[t]();else if(Array.isArray(e))Re.listeners[t].apply(null,e);else{const e=Array.prototype.slice.call(arguments);e.shift(),Re.listeners[t].apply(null,e)}}else st("trigger_event","No event",B.WS)}function Je(t,e){null!==Re.net_timer&&clearTimeout(Re.net_timer),Re.net_timer=setInterval(t,e)}function Fe(){null!==Re.net_timer&&(clearTimeout(Re.net_timer),Re.net_timer=null),null!==Re.xhr_reconnect&&Re.xhr_reconnect.abort()}function Ye(t){Re.connected!==t&&(tt("socket.online",t,B.WS),Re.connected=t,De("online",t))}Nt.on("online",function(){tt("window.online","ONLINE",B.WS),ls()&&Re.reconnect()}),Nt.on("offline",function(){tt("window.offline","OFFLINE",B.WS),Re.connected&&Re.close(4904,"Offline")}),Re.on=function(t,e){"string"==typeof t?""!==t?"function"==typeof e?Re.listeners[t]=e:st("socket.on: Listener is not a function",B.WS):st("socket.on: Empty event",B.WS):st("socket.on: Invalid event",B.WS)},Re.connect=function(){Re.ws?st("socket.connect","Already connected",B.WS):(Re.ws=new WebSocket(document.location.href.replace("https://","wss://")),nt("socket.connect",Re.ws.url,B.WS),Re.ws.id=Re.new_socket_id++,Re.ws.new_msg_id=0,Re.ws.callbacks={},Re.ws_sockets[Re.ws.id]=Re.ws,$(Re.ws).on("open",function(t){t=t.originalEvent,tt("socket.ws.open","sid "+this.id,B.WS),Re.ws.id===this.id?(Ye(!0),De("connected",t),Je(Re.ping,15e3)):st("socket.ws.open","sid "+this.id+": BUG: Socket opening is not socket.ws",B.WS)}),$(Re.ws).on("close",function(t){if(t=t.originalEvent,tt("socket.ws.close","sid "+this.id+": "+t.code+', "'+t.reason+'", '+(t.wasClean?"clean":"not clean"),B.WS),Re.ws&&Re.ws.id===this.id){if(Ye(!1),Fe(),Re.ws=null,delete Re.ws_sockets[this.id],navigator.onLine&&!document.hidden)switch(t.code){case 4403:Cn();case 4904:case Pe:break;case 4e3:setTimeout(Re.reconnect,1e3);break;default:Re.reconnect()}De("closed",t)}else delete Re.ws_sockets[this.id]}),$(Re.ws).on("message",function(t){if(t=t.originalEvent,Re.ws.id===this.id)if(t.data){var e=t.data;switch(e){case"PING":try{Re.ws.send("PONG")}catch(t){st("socket.ws.message","sid "+this.id+": readyState "+Re.ws.readyState+", ws.send PONG error: "+JSON.stringify(t),B.WS)}return;case"PONG":return}try{e=JSON.parse(e)}catch(t){return void st("socket.ws.message","Invalid app message: "+e,B.WS)}switch(e.type){case"MSG":const t=function(){try{Re.ws.send(JSON.stringify({type:"ACK",id:e.id,args:Array.prototype.slice.call(arguments)}))}catch(t){st("socket.ws.message","sid "+this.id+": ws.send ACK error: "+JSON.stringify(t),B.WS)}};e.args.push(t),De(e.msg,e.args),Re.ws.new_msg_id++;break;case"ACK":Re.ws.callbacks[e.id]&&(clearTimeout(Re.ws.callbacks[e.id].timeout),Re.ws.callbacks[e.id].callback.apply(null,e.args),delete Re.ws.callbacks[e.id])}}else st("socket.ws.onmessage","sid "+this.id+": No message",B.WS)}),$(Re.ws).on("error",function(t){t=t.originalEvent,tt("socket.ws.error","sid "+this.id,B.WS),De("error",t)}))},Re.emit=function(t){if(!t)return void st("socket.emit","Invalid message",B.WS);if(!Re.ws)return void st("socket.emit","No socket.ws object",B.WS);if(Re.ws.readyState!==WebSocket.OPEN)return void st("socket.emit","Not connected",B.WS);const e=[];var n=arguments.length;"function"==typeof arguments[n-1]&&(n--,Re.ws.callbacks[Re.ws.new_msg_id]={callback:arguments[n],timeout:setTimeout(function(t){Re.ws&&delete Re.ws.callbacks[t]},1e4,Re.ws.new_msg_id)});for(var o=1;o<n;o++)e.push(arguments[o]);const s=JSON.stringify({type:"MSG",id:Re.ws.new_msg_id,msg:t,args:e});try{Re.ws.send(s)}catch(t){st("socket.emit","sid "+Re.ws.id+": ws.send error: "+JSON.stringify(t),B.WS)}Re.ws.new_msg_id++},Re.ping=function(){try{Re.ws.send("PING")}catch(t){st("socket.ping","sid "+Re.ws.id+": ws.send error: "+JSON.stringify(t),B.WS)}};var Ke="";Re.reconnect=function(){Fe(),Re.xhr_reconnect=$.ajax({url:document.location.href+"?fuc="+("00000000000"+Math.floor(1e12*Math.random())).slice(-12),method:"head",timeout:15e3,success:function(t,e,n){Ke="",Re.xhr_reconnect=null,tt("socket.reconnect","HEAD: success: "+e+": "+n.status+" "+n.statusText,B.WS),Re.connect()},error:function(t,e,n){const o="HEAD: error: "+e+": "+t.status+" "+t.statusText;Ke!==o&&(Ke=o,tt("socket.reconnect",o,B.WS)),Re.xhr_reconnect=null,"abort"!==t.status&&(Re.net_timer=setTimeout(Re.reconnect,1e3))}})},Re.close=function(t,e){if("number"!=typeof t&&(t=1001),"string"!=typeof e&&(e=""),tt("socket.close","sid "+Re.ws.id+": "+t+', "'+e+'"',B.WS),Re.ws){try{Re.ws.close(t,e)}catch(t){st("socket.close","sid "+Re.ws.id+": ws.close error: "+JSON.stringify(t),B.WS)}De("closing",t,e)}else st("socket.close","sid "+Re.ws.id+": No socket.ws object",B.WS)};var Ve={},Be=1;function qe(t,e){const n=$dialogbox_template.clone(),o="dialogbox_"+Be++,i=n.find(".dialog-message");return n.attr("id",o),Ve[o]={$dialog:n,args:e,return_to_holding:!1},e.fullwidth&&n.find(".dialogbox-content").css("width","100%"),e.fullheight&&n.find(".dialogbox-content").css("height","100%"),e.scroll&&i.css("overflow-y","scroll"),"string"==typeof t?i.html(t):t instanceof jQuery?(Ve[o].return_to_holding=!0,i.append(t)):i.html("Invalid dialog box content"),e.no_buttons?n.find(".dialog-buttons").remove():(n.find(".dialog-buttons").toggleClass("border-thin-top",!0===e.scroll),n.find("#ok_button").toggle(void 0!==e.ok_button&&!1!==e.ok_button),n.find("#cancel_button").toggle(void 0!==e.cancel_button&&!1!==e.cancel_button),n.find("#close_button").toggle(void 0!==e.close_button&&!1!==e.close_button),n.find("#save_button").toggle(void 0!==e.save_button&&!1!==e.save_button),n.find("#delete_button").toggle(void 0!==e.delete_button&&!1!==e.delete_button),n.find("#discard_button").toggle(void 0!==e.discard_button&&!1!==e.discard_button)),n.on("keydown",function(t){const e=$(this),n=e.attr("id");if(Ve[n].args.no_buttons)switch(t.keyCode){case s:case l:return Qe(n),!1}else switch(t.keyCode){case s:return tn(e.find("#"+Ve[n].args.default_button)),!1;case l:return tn(e.find("#"+Ve[n].args.escape_button)),!1}}),n.find(".dialog-buttons .dialog-button").each(function(t){const n=$(this);e[n.attr("id")]&&n.on("click",function(t){return tn(n),!1})}),$("#dialogboxes").append(n),"function"==typeof e.init&&e.init(n),n.show().focus(),Ze(o),"function"==typeof e.init_visible&&e.init_visible(n),n}function ze(t,e){qe('<div class="hvpad cursor-default">'+t.replace(/\n/g,"<br>")+"</div>",e)}function Qe(t){if("string"==typeof t){const e=Ve[t];e.return_to_holding&&Gt.append(e.$dialog.find(".dialog-message").children()),"function"==typeof e.args.close&&e.args.close(e.$dialog),e.$dialog.remove(),delete Ve[t]}}function Xe(){$("#dialogboxes .dialogbox").each(function(t){Ze($(this).attr("id"))})}function Ze(t){const e=Ve[t].$dialog,n=e.find(".dialogbox-content"),o=e.find(".dialog-message"),s=e.find(".dialog-buttons");n.css("max-width",1.25*Ut.width()),o.height(n.innerHeight()-s.outerHeight(!0))}function tn(t){const e=t.parents(".dialogbox").attr("id"),n=Ve[e].args[t.attr("id")];var o=!0;"function"==typeof n&&(o=n(t)),o&&Qe(e)}function en(t,e){t.prop("checked",e)}function nn(t){return t.is(":checked")}function sn(t){var e=!1;return t.find(".checkbox").each(function(t,n){return!(e=-1!=n.className.search("checked"))}),e}function on(t,e,n){var o=t.hasClass("checked");e.find(".checkbox"+("string"==typeof n?"."+n:"")).each(function(t,e){$(e).toggleClass("checked",o)})}function an(t,e){var n=0;return t.find(".checkbox"+("string"==typeof e?"."+e:"")).each(function(t,e){$(e).hasClass("checked")&&n++}),n}function rn(t,e,n){var o="";return t.find(".checkbox"+("string"==typeof e?"."+e:"")).each(function(t,e){$(e).hasClass("checked")&&(o+="|"+e.getAttribute(n))}),""!=o&&(o+="|"),o}function cn(){return Ut.scrollTop()}function ln(t,e,n){null!=t&&(e?Ut.animate({scrollTop:t},150,n):Ut.scrollTop(t))}function un(){ln(0,!0,null)}function dn(){ln($("#content_pad").position().top+Ut.scrollTop(),!0,null)}function mn(t,e,n){var o=null;"object"==typeof t?o=t:"string"==typeof t&&(o=$("#"+t)),null!=o&&(o.show(),ln(o.position().top+cn()-(e?(Ut.height()-o.height())/2:0),n))}function gn(t,e,n){mn("list_row_"+t,e,n)}function fn(t,e,n){var o=null;"object"==typeof t?o=t:"string"==typeof t&&(o=$("#"+t)),null!=o&&(o.stop(!0,!0),e?n?o.effect("highlight",{color:"#FFFFE0"},2e3):o.addClass("highlight"):o.removeClass("highlight"))}function pn(t,e,n){fn("list_row_"+t,e,n)}function _n(t){hide_datalist(),mn(t,!0,!0),fn(t,!0,!0)}function hn(t){hide_datalist(),mn("list_row_"+t,!0,!0),fn("list_row_"+t,!0,!0)}var bn=null,wn=!0,vn=null,yn=null,kn=40,$n=null;function jn(){$n=setTimeout(function(){$n=null},1e4)}function xn(){clearTimeout($n),$n=null}function Sn(t,e){window.document.execCommand(t,!1,e)}function Cn(){null!==Wt&&(Wt.remove(),Wt=null)}function Nn(){var t,e=Nt.height(),n=0,o=Vt.height();e-=(t=Et.outerHeight())+(n=Ht.outerHeight()-o),Ki.height(Math.min(kn*Ji+parseInt($(".emoji").css("padding-bottom")),e-(o-Ki.height()))),e-=o=Vt.height(),n+=o,$content_scroll.css("top",t+"px").css("bottom",n+"px"),Pt.css("min-height",e+"px"),Rt.css("min-height",e+"px"),bs()}function On(t){Gt.append(Ut.children()),Ut.append(t)}function In(){const t=ls(),e=Re.connected;Et.toggleClass("disconnected",t&&!e).css("height","auto"),qn({title:t?ds?ds.name:"Are you talking to yourself?":app.info.name,subtitle:t?ds?ds.participants:"Kinda looks like you're talking to yourself":"Chat with crazy people"}),$("#header #avatar").toggleClass("icon-about",!t).toggleClass("icon-conversations",t),$("#hamburger_menu_username").html("Hamburger menu"+(t&&e?" for "+ns.name:"")),$("#hamburger_menu_notifications").toggle(t),$("#hamburger_menu_conversations").toggle(t),$("#hamburger_menu_search").toggle(t),$("#hamburger_menu_go_to_date").toggle(t),$("#hamburger_menu_images").toggle(t),$("#hamburger_menu_stats").toggle(t),$("#hamburger_menu_settings").toggle(t),$("#hamburger_menu_logout").toggle(t),$("#footer #progressbar").toggle(t),$("#footer #inputbar").toggle(t),On(t?Rt:Pt),t?($("#footer #emojibar #common_emojis").toggle(!!ds&&ns.settings.display.always_show_common_emojis),e&&(ce(ht)?Ot.css("background-color",ns.settings.display.background_color):Ot.css("background",ns.settings.display.background_color+' url("'+window.location.pathname+ns.settings.display.background_wallpaper+'") top left / 100% 100% no-repeat fixed'),$("#footer #inputbar #emoji_button_container").toggle(ns.settings.messages.emoji_button),$("#footer #inputbar #send_button_container").toggle(ns.settings.messages.send_button),Rt.find(".media-item-name").toggleClass("hidden",!ns.settings.media.show_filename)),$("#footer #inputbar #attachment_button").toggleClass("dim50",!e).prop("disabled",!e),$("#footer #inputbar #send_button").toggleClass("dim50",!e).prop("disabled",!e),e||Ds(),Wn()):(Ot.css("background-color","black"),Ot.css("background-image","none")),Nn()}function Wn(){}Nt.on("load",function(t){ce("android")?(window.history.replaceState({location:"base"},"",""),window.history.pushState({location:"home"},"","")):window.history.replaceState({location:"home"},"","")}),Nt.on("popstate",function(t){switch(tt("window.popstate","",B.UI),t.originalEvent.state.location){case"base":window.history.pushState({location:"home"},"","");break;case"home":$("#lightbox").is(":visible")&&es()}}),Tt.ready(function(){const t=Vi();Et.css("left","-"+t+"px"),Ht.css("left","-"+t+"px"),Mt.hide(),At.show(),qn({}),Wn(),Nn(),Sn("enableObjectResizing",!1),Nt.on("focus",function(t){ds&&(ds.new_msgs=!1,Yn(),Vn(!0,!0))}),Nt.on("resize",function(t){Nn(),Xe()}),Nt.on("mousemove touchstart touchmove",function(t){null===$n&&document.hasFocus()&&ds&&ds.unread_msgs.length>0&&(jn(),ds.new_msgs&&(ds.new_msgs=!1,Vn(!1,!0)),Ms())}),Nt.on("click",function(t){3===t.which||(Ds(),qs())}),Tt.on("visibilitychange",function(){document.hidden||ls()&&!Re.connected&&Re.reconnect()}),$("#app_about_content").click(function(t){return Qe($(this).parents(".dialogbox").attr("id")),!1})});const En=250;var Mn=null;function An(t){"number"!=typeof t&&(t=En),Mn=setTimeout(function(){Mn=null,It.show()},t)}function Ln(){null!==Mn&&(clearTimeout(Mn),Mn=null),It.hide()}const Hn=10;var Un=0,Gn=0,Pn=null,Rn=null;function Dn(){null===Rn?(Gn=.05,qt.css("opacity",Un),qt.show(),null!==Pn&&clearTimeout(Pn),Pn=setInterval(function(){Un+=Gn,qt.css("opacity",Un),Un<=0?Gn=.01:Un>=1&&(Gn=-.01)},Hn)):clearTimeout(Rn),Rn=setTimeout(function(){Rn=null,Jn()},jt)}function Jn(){null!==Rn&&(clearTimeout(Rn),Rn=null),null!==Pn&&(Gn=-.05,clearTimeout(Pn),Pn=setInterval(function(){Un+=Gn,qt.css("opacity",Un),Un<=0&&(qt.hide(),clearTimeout(Pn),Un=0,Pn=null)},Hn))}function Fn(){if(ns.settings.messages.new_msg_indicator&&!document.hasFocus()){var t="* ";null!==yn&&clearTimeout(yn),document.title=t+app.info.name,yn=setInterval(function(){t=""===t?"* ":"",document.title=t+app.info.name},xt)}}function Yn(){null!==yn&&(clearTimeout(yn),yn=null,document.title=app.info.name)}function Kn(t){app.support.serviceworker&&app.support.pushmanager?Notification.requestPermission(function(e){"granted"===e&&navigator.serviceWorker.ready.then(function(e){"string"!=typeof t.icon&&(t.icon="img/G16.png"),t.renotify=!0,e.showNotification(t.title,t)})}):app.support.notifications&&("granted"!==Notification.permission&&Notification.requestPermission(),"granted"===Notification.permission&&new Notification(t.title,{icon:t.icon,image:t.image,body:t.body}))}function Vn(t,e){ns.settings.messages.notifications&&ds&&Bn(Ct+ds.id,t,e)}function Bn(t,e,n){tt("ui_clear_notification",t,B.UI),"string"!=typeof t&&(t=""),e&&fe({msg:"clear_notifications",tag:t}),n&&Re.connected&&Re.emit("user_clear_notifications")}function qn(t){Mt.toggle(null==ns||ns.settings.display.large_titlebar),At.toggle(null!=ns&&!ns.settings.display.large_titlebar),$("#header #title").html("string"==typeof t.title?""==t.title?"&nbsp;":t.title:"&nbsp;"),$("#header #subtitle").html("string"==typeof t.subtitle?""==t.subtitle?"&nbsp;":t.subtitle:"&nbsp;"),At.html("string"==typeof t.subtitle?""==t.subtitle?"&nbsp;":t.subtitle:"&nbsp;")}function zn(){qe(se,{fullwidth:!0,fullheight:!0,init:Qn,close:Zn,save_button:Xn,cancel_button:!0,default_button:"save_button",escape_button:"cancel_button"})}function Qn(t){se.find("#settings_profile_username").val(ns.username),se.find("#settings_profile_display_name").val(ns.name),se.find("#settings_profile_avatar").val(ns.avatar),se.find("#settings_profile_public").val(ns.public),se.find("#settings_display_background_color").val(ns.settings.display.background_color),se.find("#settings_display_background_color_picker").val(ns.settings.display.background_color),se.find("#settings_display_background_wallpaper").val(ns.settings.display.background_wallpaper),en(se.find("#settings_display_large_titlebar"),ns.settings.display.large_titlebar),en(se.find("#settings_display_message_headers"),ns.settings.display.message_headers),se.find("#settings_display_timestamp_format").val(ns.settings.display.timestamp_format),en(se.find("#settings_display_avatars"),ns.settings.display.avatars),en(se.find("#settings_display_always_show_common_emojis"),ns.settings.display.always_show_common_emojis),en(se.find("#settings_display_single_click_emojis"),ns.settings.display.single_click_emojis),se.find("#settings_display_emoji_scale").val(ns.settings.display.emoji_scale),en(se.find("#settings_display_special_fx"),ns.settings.display.special_fx),en(se.find("#settings_messages_send_on_enter"),ns.settings.messages.send_on_enter),en(se.find("#settings_messages_send_button"),ns.settings.messages.send_button),en(se.find("#settings_messages_emoji_button"),ns.settings.messages.emoji_button),en(se.find("#settings_messages_show_others_typing"),ns.settings.messages.show_others_typing),en(se.find("#settings_messages_tell_others_typing"),ns.settings.messages.tell_others_typing),en(se.find("#settings_messages_notifications"),ns.settings.messages.notifications),en(se.find("#settings_messages_notifications_show_content"),ns.settings.messages.notifications_content),en(se.find("#settings_messages_previews"),ns.settings.messages.previews),en(se.find("#settings_messages_new_msg_indicator"),ns.settings.messages.new_msg_indicator),en(se.find("#settings_messages_delivery_confirmation"),ns.settings.messages.delivery_confirmation),en(se.find("#settings_messages_read_on_mousemove"),ns.settings.messages.read_on_mousemove),en(se.find("#settings_messages_read_on_typing"),ns.settings.messages.read_on_typing),en(se.find("#settings_media_show_filename"),ns.settings.media.show_filename)}function Xn(t){var e=t.parents(".dialogbox"),n=se.find("#settings_profile_password").val(),o={name:ns.name},s={settings:{display:{},messages:{},media:{}}};if(""===n)s.current_password=!1,s.username=ns.username,s.name=ns.name,s.public=ns.public;else{if(s.current_password=n,s.new_password=se.find("#settings_profile_new_password").val(),""!==s.new_password&&s.new_password!==se.find("#settings_profile_confirm_password").val())return ze("Smooth move ex-lax, your new passwords don't match.  Try typing the same password in each password box this time.",{init:function(t){t.find("#ok_button span").html("How do I computer?")},ok_button:function(t){return se.find("#settings_profile_new_password").focus(),!0},default_button:"ok_button",escape_button:"ok_button"}),!1;s.username=se.find("#settings_profile_username").val(),s.name=se.find("#settings_profile_display_name").val(),s.public=nn(se.find("#settings_profile_public"))}s.settings.display.theme=se.find("#settings_display_theme").val(),s.settings.display.background_wallpaper=se.find("#settings_display_background_wallpaper").val(),s.settings.display.background_color=se.find("#settings_display_background_color").val(),s.settings.display.large_titlebar=nn(se.find("#settings_display_large_titlebar")),s.settings.display.message_headers=nn(se.find("#settings_display_message_headers")),s.settings.display.timestamp_format=se.find("#settings_display_timestamp_format").val(),s.settings.display.avatars=nn(se.find("#settings_display_avatars")),s.settings.display.always_show_common_emojis=nn(se.find("#settings_display_always_show_common_emojis")),s.settings.display.single_click_emojis=nn(se.find("#settings_display_single_click_emojis")),s.settings.display.emoji_scale=se.find("#settings_display_emoji_scale").val(),s.settings.display.special_fx=nn(se.find("#settings_display_special_fx")),s.settings.messages.send_on_enter=nn(se.find("#settings_messages_send_on_enter")),s.settings.messages.send_button=nn(se.find("#settings_messages_send_button")),s.settings.messages.emoji_button=nn(se.find("#settings_messages_emoji_button")),s.settings.messages.show_others_typing=nn(se.find("#settings_messages_show_others_typing")),s.settings.messages.tell_others_typing=nn(se.find("#settings_messages_tell_others_typing")),s.settings.messages.notifications=nn(se.find("#settings_messages_notifications")),s.settings.messages.notifications_content=nn(se.find("#settings_messages_notifications_show_content")),s.settings.messages.previews=nn(se.find("#settings_messages_previews")),s.settings.messages.new_msg_indicator=nn(se.find("#settings_messages_new_msg_indicator")),s.settings.messages.delivery_confirmation=nn(se.find("#settings_messages_delivery_confirmation")),s.settings.messages.read_on_mousemove=nn(se.find("#settings_messages_read_on_mousemove")),s.settings.messages.read_on_typing=nn(se.find("#settings_messages_read_on_typing")),s.settings.media.show_filename=nn(se.find("#settings_media_show_filename")),Re.emit("user_save_settings",s,function(t){if(t)ze("Some fucking shit went wrong:<br><br>"+t,{init:function(t){t.find("#ok_button span").html("It's my fault")},ok_button:function(t){return se.find("#settings_profile_password").focus(),!0},default_button:"ok_button",escape_button:"ok_button"});else{const t=!1!==s.current_password;delete s.current_password,delete s.new_password,ns=s,Pi(s.settings.display.emoji_scale),s.settings.messages.notifications||Bn(),Zn(e),Qe(e.attr("id")),In(),pe(),t&&s.name!==o.name&&(o.name=s.name,Re.emit("user_update",o))}})}function Zn(t){se.find('input[type="password"]').val("")}function ts(t){Bt.blur(),$("#lightbox_image").attr("src",me(t)).css("max-width","100%").css("max-height","100%"),$("#lightbox_info").attr("media-id",t),$("#lightbox").show().focus(),history.pushState({location:"lightbox"},"","")}function es(){$("#lightbox").hide(),$("#lightbox_image").attr("src",""),$("#lightbox_info").html(""),$("#lightbox_info").toggleClass("hidden",!0),xs&&Bt.focus()}Tt.ready(function(){$("#avatar").on("click",function(t){return ms(),!1})}),Tt.ready(function(){$("#hamburger_button").on("click",function(t){return Lt.show(),Lt.focus(),!1}),Lt.on("keydown",function(t){switch(t.keyCode){case l:return Lt.hide(),!1}}),Lt.on("click",function(t){return Lt.hide(),!1}),Lt.find("#hamburger_menu_content").click(function(t){return!1}),Lt.find(".hamburger-menu-item").click(function(t){switch(Lt.hide(),$(this).attr("id")){case"hamburger_menu_notifications":us();break;case"hamburger_menu_conversations":ms();break;case"hamburger_menu_search":ji();break;case"hamburger_menu_go_to_date":Ci();break;case"hamburger_menu_images":Ai();break;case"hamburger_menu_stats":le();break;case"hamburger_menu_help":ue();break;case"hamburger_menu_settings":zn();break;case"hamburger_menu_delete":ze("hahahahaha fuuuuuuuck that!",{ok_button:!0,cancel_button:!0,default_button:"ok_button",escape_button:"cancel_button"});break;case"hamburger_menu_install":re();break;case"hamburger_menu_refresh":window.location.reload();break;case"hamburger_menu_debug":rt();break;case"hamburger_menu_positive_message":ze("You are a terrific person!",{ok_button:function(t){return alert("(K)"),!0},cancel_button:!0,default_button:"ok_button",escape_button:"cancel_button"});break;case"hamburger_menu_about":de();break;case"hamburger_menu_logout":rs();break;case"hamburger_menu_logout":window.open("https://youtu.be/_Uj8p6GNIRY","_blank").focus()}return!1})}),Tt.ready(function(){se.find(".section-heading").on("click",function(t){return $(this).next().toggle(),!1});var t=1;se.find("#test_notifications").on("click",function(e){return Kn({tag:"msg_notification_test",title:"Super duper give'r test notification "+t++,body:"Testes, testes, 1, 2, 3...?"}),!1}),se.find("#settings_display_background_color").on("change",function(t){se.find("#settings_display_background_color_picker").val($(this).val())}),se.find("#settings_display_background_color_picker").on("change",function(t){se.find("#settings_display_background_color").val($(this).val().toUpperCase())}),se.find("#settings_profile_avatar_preview").on("click",function(t){return!1}),Re.on("user_save_settings_successful",function(t){tt("socket.user_save_settings_successful","",B.USER)})}),Tt.ready(function(){$("#lightbox").on("keydown",function(t){switch(t.keyCode){case s:case l:return history.back(),!1}}),$("#lightbox_info_button").on("click",function(t){var e=$("#lightbox_info");return""==e.html()&&Re.emit("app_media_info",e.attr("media-id"),function(t){e.html(t)}),e.toggleClass("hidden"),!1}),$("#lightbox_content").on("click",function(t){return history.back(),!1}),$("#lightbox_image").on("click",function(t){return"100%"==$("#lightbox_image").css("max-width")?$("#lightbox_image").css("max-width","").css("max-height",""):$("#lightbox_image").css("max-width","100%").css("max-height","100%"),!1}),$("#lightbox_open_button").on("click",function(t){return window.open($("#lightbox_image").attr("src"),"_blank"),!1}),$("#lightbox_close_button").on("click",function(t){return history.back(),$("#lightbox_image").attr("src",""),!1})});var ns=null;function ss(){qe($("#app_login").html(),{init:function(t){t.find("#login_username").on("keydown",function(e){if(e.keyCode==s)return t.find("#login_password").focus(),!1})},ok_button:function(t){var e=t.parents(".dialogbox"),n=e.find("#login_username").val().trim(),o=e.find("#login_password").val().trim();return""==n?(e.find("#login_message").html("Try really hard to enter a username."),e.find("#username").focus()):""==o?(e.find("#login_message").html("Try really hard to enter a password."),e.find("#password").focus()):is(n,o,e),!1},cancel_button:!0,default_button:"ok_button",escape_button:"cancel_button"}).find("#login_username").focus()}function is(t,e,n){$.ajax({url:"login",method:"post",data:JSON.stringify({username:t,password:e}),contentType:"application/json",success:function(t,e,o){tt("user_login",e+": "+o.status+" "+o.statusText+": "+t,B.LOGIN),n&&Qe(n.attr("id")),Re.connect()},error:function(t,e,o){if(st("user_login",e+": "+t.status+" "+o,B.LOGIN),n){switch(t.status){case 401:case 403:n.find("#login_message").html("Nice try.");break;default:n.find("#login_message").html("Sheeeit: "+t.status+" "+o)}n.find("#password").focus()}}})}function os(){$.ajax({url:"login",method:"get",success:function(t,e,n){tt("user_login_token",e+": "+n.status+" "+n.statusText+": "+t,B.LOGIN),Re.connect()},error:function(t,e,n){st("user_login_token",e+": "+t.status+" "+n,B.LOGIN),In(),Cn()}})}function as(t){tt("user_load",t?t.username+" / "+t.name:"null",B.USER),t?(ns=t,pe(),Pi(t.settings.display.emoji_scale),0==t.current_cnv&&(t.current_cnv=null),fs(t.current_cnv),Cn()):cs()}function rs(){tt("user_logout","",B.USER),Re.emit("user_logout",function(){$.ajax({url:"logout",method:"get",success:function(t,e,n){tt("user_logout",e+": "+n.status+" "+n.statusText+": "+t,B.USER),Re.close(Pe,"User requested logout"),cs()},error:function(t,e,n){st("user_logout",e+": "+t.status+" "+n,B.USER),In(),ze("Logout failed:<br><br>"+e+": "+n+"<br><br>"+JSON.stringify(t).replace(/"\n"/g,"<br>"),{close_button:!0,default_button:"close_button",escape_button:"close_button"})}})})}function cs(){ns=null,Ds(),qs(),Dt.hide(),In()}function ls(){return null!==ns}Tt.ready(function(){$("#welcome").click(function(t){return ss(),!1}),os()}),Re.on("online",function(t){t&&ds&&(ds.msg_read_all_lock=!1),ls()&&In()}),Re.on("app_start",function(t){tt("socket.app_start","",B.INIT),An(),t(),ge(),Re.emit("user_load",function(t){tt("socket.user_load","",B.USER),as(t)})}),Re.on("user_update",function(t,e){if(tt("socket.user_update",t.name,B.USER),ds&&t.prev_name!=t.name){for(var n in ds.users)if(ds.users[n].name==t.prev_name){ds.users[n].name=t.name;break}ps(ds),In()}e()});var wi=null;function yi(t,e){ns.settings.messages.previews&&("top"===e||void 0===e?Et.append(Ri):"bottom"===e&&Ht.prepend(Ri),Ri.html('<span class="st1 bold">'+t.name+"</span><br>"+t.body).attr("cnv_id","number"==typeof t.cnv_id?t.cnv_id:"").show(),clearTimeout(wi),wi=setTimeout(function(){ki()},vi))}function ki(){null===wi&&(clearTimeout(wi),wi=null),Ri.hide()}function us(){qe($("#app_notifications").html(),{fullwidth:!0,scroll:!0,populate:function(){},close_button:!0,escape_button:"close_button"})}Tt.ready(function(){Ri.on("click",function(t){const e=parseInt(Ri.attr("cnv_id"));return ki(),e===ds.id?(ds.at_bottom=!0,bs()):fs(e),!1}),Ri.on("mousemove",function(t){return null!==wi&&(clearTimeout(wi),wi=null),!1}),Ri.on("mouseout",function(t){return wi=setTimeout(function(){ki()},vi),!1})});var ds=null;ps(null),Tt.ready(function(){Ut.on("scroll",function(t){return ds&&(ds.at_bottom=Ut.scrollTop()>=Math.floor(Rt.height()-Ut.height()-10),ds.at_bottom&&0!==$("#footer #previewbar").length&&ki()),!1}),$("#app_conversation_search #search_text_input").on("keydown",function(t){t.keyCode==s&&$("#app_conversation_search #search_button").trigger("click")}),$("#app_conversation_search #search_button").on("click",function(t){return Si($("#app_conversation_search #search_text_input").val()),!1})});var Yi=null;function ms(){tt("cnv_show_list","",B.CNV),Re.emit("cnv_list",function(t){const e=$("#app_conversations #conversations"),n=$("#templates .cnv-item");var o=null,i="";for(var a in e.children().remove(),(o=n.clone()).attr("id","0").find(".cnv-item-name").html("Close current conversation"),e.append(o).append("<hr>"),t)i=t[a].participants.replace(new RegExp("(, )?"+ns.name+"(, )?",""),""),(o=n.clone()).attr("id",t[a].id),o.find(".cnv-item-name").html(""!==t[a].user_name?t[a].user_name:t[a].name),o.find(".cnv-item-participants").html(""!=i?i:"no one"),e.append(o);qe($("#app_conversations"),{fullwidth:!0,init:function(t){Yi=t,t.find(".cnv-item").on("click",function(e){Qe(t.attr("id"));var n=parseInt($(this).attr("id"));return 0===n&&(n=null),An(),fs(n),!1}),t.find("#new_conversation_name").on("keydown",function(e){e.keyCode===s&&t.find("#create_new_conversation").trigger("click")}),t.find("#create_new_conversation").on("click",function(t){const e=$("#new_conversation_name").val();return""!=e.trim()?(An(),gs(e)):ze("Enter a name, dumbo.",{ok_button:!0,default_button:"ok_button",escape_button:"ok_button"}),!1})},close_button:!0,escape_button:"close_button"})})}function gs(t){tt("cnv_create",t,B.CNV),Re.emit("cnv_create",t,function(t,e){e?(Qe(Yi.attr("id")),Yi=null,$("#new_conversation_name").val(""),fs(e)):(Ln(),ze(t,{ok_button:!0,default_button:"ok_button",escape_button:"ok_button"}))})}function fs(t){if(tt("cnv_load","cnv "+t,B.CNV),null===t){Jn(),ps(null),Rt.empty(),Hs({id:0,this_user:!1,name:app.info.name,status:ws,body:'Shit\'s about to get real yo.<br><br><span id="open_hamburger_menu" class="link">Go to the hamburger</span> and open a conversation for maximum craziness.<br><br>Or sit here and look at the Dumpster Grumpster:<br><br><img class="expand-x" src="img/kittenkittentongue.jpg"><br><br>',created:moment().format()},null).find("#open_hamburger_menu").on("click",function(t){$("#hamburger_button").trigger("click")}),Rt.find(".msg-load-links").remove(),In(),e()}else ds&&t==ds.id?(In(),e()):Re.emit("cnv_load",t,function(t,n){Jn(),ps(n),Rt.empty(),In(),e(),Bt.focus()});function e(){ds?_s("last",bt,0,function(){Ln(),Cn()}):(Ln(),Cn())}}function ps(t){if(null===t||"object"!=typeof t)ds=null;else{var e="";for(var n in t.users)t.users[n].name!==ns.name&&(e+=(""===e?"":", ")+t.users[n].name);""!==t.user_name&&(t.name=t.user_name),delete t.user_name,(ds=t).participants=e,ds.temp_msg_id=1,ds.unread_msgs=[],ds.msg_read_all_lock=!1,ds.at_bottom=!0}}function _s(t,e,n,o){tt("cnv_load_messages",e+" <- "+t+" -> "+n,B.CNV),Re.emit("cnv_load_msg_range",t,e,n,function(t,e,n,s){if(t)st(t);else{var i=null,a=ns.settings.messages.delivery_confirmation?[]:null,r=Rt.find(".message").last();if((0===r.length||s)&&(r=null),0===Rt.find("#msg_load_links_prev").length){const t=$("#templates #msg_load_links_prev").clone();n||t.find("span").not(":last").remove(),Rt.prepend(t),t.find(".msg-load-link").on("click",function(t){An();const e=$(this).html().toLowerCase(),n=Os(Rt.find(".message").first());switch(Rt.empty(),e){case"top":ds.at_bottom=!1,_s("first",0,bt,function(){Ln()});break;case"bottom":ds.at_bottom=!0,_s("last",bt,0,function(){bs(Rt),Ln()});break;default:ds.at_bottom=!0,_s(n,parseInt(e),0,function(){bs(Rt),Ln()})}})}for(var c in e)(i=e[c]).this_user||i.status!==vs||(i.status=ys,null!==a&&a.push(i.id)),i.created=moment(i.created+"Z").format(),r=Hs(i,r);if(r){const t=r.parent().next();1===t.length&&t.children().first().remove()}if(s&&0===Rt.find("#msg_load_links_next").length){const t=$("#templates #msg_load_links_next").clone();Rt.append(t),t.find(".msg-load-link").on("click",function(t){An();const e=Os(Rt.find(".message").last());Rt.empty();const n=$(this).html().toLowerCase();switch(n){case"top":ds.at_bottom=!1,_s("first",0,bt,function(){Ln()});break;case"bottom":ds.at_bottom=!0,_s("last",bt,0,function(){bs(Rt),Ln()});break;default:ds.at_bottom=!1,_s(e,0,parseInt(n),function(){Ln()})}})}bs(Rt),setTimeout(function(){null!==a&&a.length>0&&Es(a)},0),"function"==typeof o&&o()}})}var $i=null;function ji(){null===$i&&($i=qe($("#app_conversation_search"),{fullwidth:!0,fullheight:!0,close_button:function(){return $i=null,!0},escape_button:"close_button"}))}function xi(){null!==$i&&(Qe($i.attr("id")),$i=null)}function Si(t){tt("cnv_search",t,B.CNV),"string"==typeof t&&""!==t&&Re.emit("cnv_search",t,function(t,e){if(t)return void st(t);const n=$("#app_conversation_search #search_results");if(e.length>0){var o=null;for(var s in n.empty(),e)e[s].created=moment(e[s].created+"Z").format(),(o=$("#templates .search-item").clone()).attr("msg_id",e[s].id),o.find(".search-item-date").html(e[s].created),o.find(".search-item-body").html(e[s].body),o.on("click",function(t){xi(),Rt.empty(),_s(parseInt($(this).attr("msg_id")),bt/2,bt/2)}),n.append(o)}else n.html("Nothing to show")})}var Ni=null;function Ci(){null===Ni&&(Ni=qe($("#app_conversation_go_to_date"),{fullwidth:!0,fullheight:!0,init:function(){Ii()},close_button:function(){return Ni=null,!0},escape_button:"close_button"}))}function Ti(){null!==Ni&&(Qe(Ni.attr("id")),Ni=null)}function Ii(){tt("cnv_list_dates","",B.CNV),Re.emit("cnv_list_dates",function(t,e){if(t)return void st(t);const n=$("#app_conversation_go_to_date #date_results");if(e.length>0){var o=null,s="";for(var i in n.empty(),e)s=e[i].date,(o=$("#templates .date-item").clone()).attr("date",s).html(s+" &mdash; "+moment(s).format("MMMM D, YYYY")),o.on("click",function(t){Ti(),Rt.empty(),ds.at_bottom=!1,_s(moment($(this).attr("date")).utc().format(),0,bt)}),n.append(o)}else n.html("Nothing to show")})}var Oi=null;function Ai(){null===Oi&&(Oi=qe($("#app_media_browser"),{fullwidth:!0,fullheight:!0,init:function(){Gi()},close_button:function(){return Oi=null,!0},escape_button:"close_button"}))}function Li(){null!==Oi&&(Qe(Oi.attr("id")),Oi=null)}function Gi(){tt("cnv_list_media","",B.CNV),Re.emit("cnv_list_media",function(t,e){if(t)return void st("cnv_list_media",t);const n=$("#app_media_browser #media_results");if(e.length>0){var o="",s="",i=null;for(var a in n.empty(),e)o=e[a].media_id,s=e[a].filename,(i=$("#templates .media-browser-item").clone()).find("a").attr("href",me(o)),i.find(".media-browser-item-thumbnail").attr("media_id",o).attr("src",me(o,"thumbnail")).on("click",function(t){return ts($(this).attr("media_id")),!1}),i.find(".media-browser-item-filename").html(s),i.find(".media-browser-item-message-link").attr("media_id",o).on("click",function(t){return An(),Li(),Re.emit("cnv_find_media_item",$(this).attr("media_id"),function(t,e){if(t)return st("cnv_list_media",t),void Ln();Rt.empty(),ds.at_bottom=!1,_s(e,10,bt-10,function(){Ln()})}),!1}),n.append(i)}else n.html("Nothing to show")})}function bs(t){function e(){$content_scroll.scrollTop(Rt.height())}ds&&ds.at_bottom&&(t&&t.find("img").on("load",e),setTimeout(e,0))}const ws="sending",vs="received",ys="unread",ks="read",$s=[112,113,114,115,116,117,118,119,120,121,122,123],js=[16,17,18,19,20,l,112,113,114,115,116,117,118,119,120,121,122,123,144,145];var xs=!1,Ss=null;function Cs(t,e){var n=window.getSelection(),o=null;if(n&&n.rangeCount&&t){Bt.is(":focus")&&((o=n.getRangeAt(0)).deleteContents(),o.collapse(!0));const s=document.createElement("img");s.className="emoji",s.src=t,e&&(s.alt=e),Ss.insertNode(s),Ss.setStartAfter(s)}}function Ns(){Re.connected&&(Ws(Bt.html()),Bt.empty(),Nn(),Bt.is(":focus")&&Bt.blur().focus(),wn=!0,Wn())}function Ts(t){return t+"_msg"}function Os(t){return parseInt(t.attr("id").replace(/_msg/,""))}function Is(t){return t.attr("id").replace(/_msg/,"")}function Ws(t){if("string"!=typeof t)return void st("msg_send","Text is not a string");if(""===(t=t.replace(/<div>/gi,"<br>").replace(/<\/div>/gi,"").replace(/^(\s*(<br>)*\s*)+/i,"").replace(/(\s*(<br>)*\s*)+$/i,"").trim().replace(/\s*(<br>)\s*/gi,"<br>")))return;if(!Re.connected)return void st("msg_send","Not connected");if("\\`"===t.substring(0,2)){switch(Hs({id:G().toUpperCase(),this_user:!0,name:ns.name,status:vs,body:t,created:moment().format()},Rt.children().last()),bs(),t.substring(2)){case"gl":Re.emit("app_send_log",parseInt(t.substring(5)),function(t){qe('<div class="hvpad pre monospace">'+t+"</div>",{close_button:!0,default_button:"close_button",escape_button:"close_button"})});break;default:Re.emit("msg_new",[{body:t}],function(t){Hs({id:G().toUpperCase(),this_user:!1,name:app.info.name,status:vs,body:t,created:moment().format()},Rt.children().last()),bs(c)})}return}for(var e=0,n=0,o="",s="",i="";n<t.length;)o=t.substring(n,n+3).toLowerCase(),void 0!==(s=Ys[o])?(i+=t.substring(e,n)+s,e=n+=3):void 0!==(s=Ys[o.substring(0,2)])?(i+=t.substring(e,n)+s,e=n+=2):n++;i=F(i=(i=(i+=t.substring(e)).replace(/https?:\/\/(www.)?(youtube-nocookie.com|youtube.com|youtu.be)\/[^\s^<]+/g,function(t){var e=0,n=0,o="";return-1!==(e=t.indexOf("watch?v="))&&(e+=8,-1===(n=t.indexOf("&",e))&&(n=t.indexOf("/",e)),o=t.substring(e,-1!==n?n:void 0)),""===o&&-1!==(e=t.indexOf("youtu.be/"))&&(e+=9,n=t.indexOf("/",e),o=t.substring(e,-1!==n?n:void 0)),""===o&&-1!==(e=t.indexOf("embed/"))&&(e+=6,n=t.indexOf("/",e),o=t.substring(e,-1!==n?n:void 0)),""!==o?'<youtube media-id="'+o+'"></youtube>':t})).replace(/https?:\/\/(www.)?(instagram.com)\/[^\s^<]+/g,function(t){var e=0,n=0,o="";return-1!==(e=t.indexOf("/p/"))&&(e+=3,-1===(n=t.indexOf("/",e))&&(n=t.indexOf("?",e)),-1===n&&(n=t.indexOf("&",e)),o=t.substring(e,-1!==n?n:void 0)),""!==o?'<instagram media-id="'+o+'"></instagram>':t}));const a={id:G().toUpperCase(),this_user:!0,name:ns.name,status:ws,body:i,created:moment().format()};var r=null;Rt.children(".message-group").length>0&&(r=Rt.children().last());const c=Hs(a,r);bs(c),Re.emit("msg_new",[{id:a.id,created:a.created,body:a.body}],function(t){c.attr("id",Ts(t)),Us(c,{this_user:!0,id:t,status:vs});const e=c.find(".msg-summary");e.html(t+e.html())})}function Es(t){ns.settings.messages.delivery_confirmation&&Re.emit("msg_delivered",t)}function Ms(){ns&&ns.settings.messages.read_on_mousemove&&Ls()}function As(){ns&&ns.settings.messages.read_on_typing&&Ls()}function Ls(){ds&&!ds.msg_read_all_lock&&ds.unread_msgs.length>0&&(ds.msg_read_all_lock=!0,Re.emit("msg_read",ds.unread_msgs))}function Hs(t,e){var n=Rt.find("#"+Ts(t.id));if(0===n.length){var o=null,s=null,i=!1,a=null,r=moment(t.created),c=r.format("HH:mm"),l=0,u=null,d=null;if(e)if(e.hasClass("message"))o=e,s=e.parent(),e=s;else{if(!e.hasClass("message-group"))throw"msg_add: $insert_point is not a jQuery .message or .message-group object";o=e.children(".message").last(),s=e}else e=null,i=!0;function m(t){(l=Math.round(moment.duration(r.diff(t)).asMinutes()))>wt&&(u=null,u=l>kt?$('<div class="msg-time-spacer-4"></div>'):l>yt?$('<div class="msg-time-spacer-3"></div>'):l>vt?$('<div class="msg-time-spacer-2"></div>'):$('<div class="msg-time-spacer-1"></div>'),e?e.after(u):Rt.prepend(u),e=u,i=!0)}null!==o?m(a=moment(o.attr("msg_created"))):a=r,null!==o&&r.date()===a.date()||(d=Qt.clone(),null===o||r.month()!==a.month()?d.find(".date-month-year").html(r.format("MMMM YYYY")):d.find(".date-month-year").remove(),d.find(".date-day").html(r.format("dddd MMM D")),null===e?Rt.append(d):e.after(d),e=d,m(moment(r).startOf("day")),i=!0),i||(i|=s.hasClass("src-msg")&&!t.this_user||s.hasClass("dst-msg")&&t.this_user),i?((s=Xt.clone()).addClass(t.this_user?"src-msg":"dst-msg"),null===u&&null===d||(null!==o&&o.after($("#templates .msg-time").clone().html(a.format("HH:mm"))),s.append($("#templates .msg-time").clone().html(c))),e.after(s),e=null):e=o,(n=Zt.clone().addClass(t.this_user?"src-msg":"dst-msg").attr("id",Ts(t.id)).attr("msg_created",t.created)).find(".msg-status").attr("title",c),n.find(".msg-summary").html(("number"==typeof t.id?t.id:"")+" &mdash; "+t.name+" &mdash; "+r.format(ns.settings.display.timestamp_format)),n.find(".msg-show").hide(),n.find(".msg-edit").remove(),s.hasClass("dst-msg")&&n.find(".msg-delete").remove(),n.find(".msg-body").html(t.body);var g=null;if(n.find("*[media-id]").each(function(){const t=$(this),e=t.attr("media-name"),n=te.clone();switch(t.before(n),n.attr("media-id",t.attr("media-id")),t.prop("nodeName").toLowerCase()){case"img":const o=t.attr("media-id");t.on("error",function(){st("msg_add",o+": thumbnail load failed",B.MSG),$(this).on("error",function(){st("msg_add",o+": image load failed",B.MSG),$(this).off("error").attr("src","img/emoji/fb/1.0/128/5-travel-and-places/066-1f386.png")}).attr("src",me(o))}).attr("src",me(o,"thumbnail")),(g=$('<a href="'+me(o)+'"></a>')).append(t),n.find(".media-wrapper").remove(),n.prepend(g),g.on("mousedown",function(t){xs=Bt.is(":focus")}),g.on("click",function(t){return ts(n.attr("media-id")),!1});break;case"audio":(g=n.find(".media-placeholder")).html('<img class="media-icon" src="img/icons/audio_cassette_PNG16090.png">'),t.remove(),g.on("click",function(t){const e=$(this),n=e.parents(".media-container");e.before('<audio class="media-item" src="'+me(n.attr("media-id"))+'" controls autoplay>').hide(),n.find(".media-close-button").show()}),n.find(".media-close-button").on("click",function(t){const e=$(this),n=e.parents(".media-container");e.hide(),n.find(".media-item").remove(),n.find(".media-placeholder").show()});break;case"video":(g=n.find(".media-placeholder")).append($('<img class="media-poster">').on("error",function(){$(this).attr("class","media-icon").attr("src","img/emoji/fb/1.0/128/6-objects/010-1f4f9.png")}).attr("src",me(t.attr("media-id"),"thumbnail"))),t.remove(),g.on("click",function(t){const e=$(this),n=e.parents(".media-container");e.append('<video class="media-item abs-pos top left" src="'+me(n.attr("media-id"))+'" controls webkit-playsinline>'),n.find(".media-close-button").show(),e.find("video").on("click",function(t){return!1}),e.find(".media-item").get(0).play()}),n.find(".media-close-button").on("click",function(t){const e=$(this),n=e.parents(".media-container");e.hide(),n.find(".media-item").remove()});break;case"youtube":const s="https://youtu.be/"+t.attr("media-id"),i="https://www.youtube-nocookie.com/embed/"+t.attr("media-id");(g=n.find(".media-placeholder")).html('<img class="media-icon" src="img/icons/YouTube_play_buttom_icon_(2013-2017).svg">'),n.children(".media-item-name").replaceWith('<a class="media-item-name block pre-break-word" href="'+s+'" target="_blank">'+s+"</a>"),t.remove(),g.on("click",function(t){const e=$(this),n=e.parents(".media-container"),o=$("#templates .youtube-wrapper").clone();o.addClass("media-item").children().attr("src",i),e.before(o).hide(),n.find(".media-close-button").show()}),n.find(".media-close-button").on("click",function(t){const e=$(this),n=e.parents(".media-container");e.hide(),n.find(".media-item").remove(),n.find(".media-placeholder").show()});break;case"instagram":const a="https://instagr.am/p/"+t.attr("media-id"),r=a+"/embed";(g=n.find(".media-placeholder")).html('<img class="media-icon" src="img/icons/Instagram_logo_2016.svg">'),n.children(".media-item-name").replaceWith('<a class="media-item-name block pre-break-word" href="'+a+'" target="_blank">'+a+"</a>"),t.remove(),g.on("click",function(t){const e=$(this),n=e.parents(".media-container"),o=$("#templates .instagram-post").clone();function s(){o.addClass("media-item").attr("src",r).height("content"),e.before(o).hide(),n.find(".media-close-button").show()}o.on("load",function(){bs()}),oe?s():(oe=!0,$.ajax({url:"https://www.instagram.com/embed.js",method:"GET",dataType:"script",crossDomain:!0,success:s}))}),n.find(".media-close-button").on("click",function(t){const e=$(this),n=e.parents(".media-container");e.hide(),n.find(".media-item").remove(),n.find(".media-placeholder").show()});break;case"a":t.attr("href","").attr("target","_blank").text(e).on("click",function(t){const e=$(this),n=e.parents(".media-container");e.attr("href",me(n.attr("media-id")))}),n.children().remove(),n.prepend(t)}e&&n.children(".media-item-name").text(e).toggleClass("hidden",!ns.settings.media.show_filename).on("click",function(t){Re.emit("app_media_info",n.attr("media-id"),function(t){qe('<div class="hvpad st1 scroll-auto"><span class="monospace pre">'+t+"</span></div>",{close_button:!0,default_button:"close_button",escape_button:"close_button"})})}),t.addClass("media-item").removeAttr("media-id").removeAttr("media-name")}),Gs(n),null===e)s.append(n);else{if(!(e.length>0))throw"msg_add: Invalid message $insert_point";e.after(n)}}return Us(n,t),n}function Us(t,e){if(e.this_user)t.find(".msg-body").toggleClass("dim50",e.status===ws);else if(ds)switch(e.status){case ws:case vs:case ys:-1===ds.unread_msgs.indexOf(e.id)&&(ds.unread_msgs.push(e.id),xn());break;case ks:var n=ds.unread_msgs.indexOf(e.id);-1!==n&&ds.unread_msgs.splice(n,1)}t.attr("msg_status",e.status).find(".msg-status").removeClass(function(t,e){return(e.match(/(^|\s)icon-status-\S+/g)||[]).join(" ")}).addClass("icon-status-"+(e.this_user?"src-":"dst-")+e.status)}function Gs(t){void 0===t&&(t=$("#conversation .message")),app.support.touch&&t.find(".msg-status").on("touchstart touchend touchcancel",function(t){t.stopPropagation()}),t.find(".msg-status").on("click",function(e){return t.find(".msg-info").toggle(),!1}),t.find(".msg-hide").on("click",function(e){return ns.hidden_msgs[Os(t)]=t,t.find(".msg-info").hide(),t.find(".msg-hide").hide(),t.find(".msg-show").show(),t.find(".msg-body").hide().after($("#templates .msg-hidden").clone()),!1}),t.find(".msg-show").on("click",function(e){return delete ns.hidden_msgs[Os(t)],t.find(".msg-info").hide(),t.find(".msg-hide").show(),t.find(".msg-show").hide(),t.find(".msg-hidden").remove(),t.find(".msg-body").show(),!1}),t.find(".msg-delete").on("click",function(e){return ze("Are you super duper sure?",{delete_button:function(){return Re.emit("msg_delete",[Os(t)]),!0},cancel_button:!0,default_button:"delete_button",escape_button:"cancel_button"}),!1})}function Ps(t){const e=$("#"+Ts(t));if(1===e.length){const n=e.parent(),o=ds.unread_msgs.indexOf(t);-1!==o&&ds.unread_msgs.splice(o,1),e.remove(),0===n.find(".message").length&&n.remove()}}function Rs(){Yt.is(":visible")||(Yt.show(),Nn())}function Ds(){Yt.is(":visible")&&(Yt.hide(),Nn())}function Js(t){"string"!=typeof t&&(t=""),Ds(),$("#attach_file_input").attr("accept",t),$("#attach_file_input").click()}function Fi(t){if(t.length>0){var e=new FormData;Ds(),qs(),As();for(var n=0;n<t.length;n++)e.append("uploads[]",t[n],t[n].name);ot(e),$.ajax({url:"upload",method:"post",contentType:!1,data:e,processData:!1,xhr:function(){var t=new XMLHttpRequest,e=$("#footer #progressbar #progress"),n=0;return t.upload.addEventListener("progress",function(t){t.lengthComputable&&(n=Math.round(t.loaded/t.total*100),e.width(n<100?n+"%":"0"))},!1),t},success:function(t,e,o){tt("form file upload",e+": "+o.status+" "+o.statusText+": "+t,B.UPLOAD);var s=null,i="";for(n in o.responseJSON)if(s=o.responseJSON[n],type=s.type.substring(0,s.type.indexOf("/")),""!=type){switch(i+=""==i?"<":" <",type){case"image":i+="img";break;case"audio":i+="audio";break;case"video":i+="video";break;default:i+="a"}i+=' media-id="'+s.id+'" media-name="'+J(s.name)+'">'}Ws(i)},error:function(t,e,n){st("form file upload",e+": "+n,B.UPLOAD),ze("Upload failed:<br><br>"+t.status+": "+n+"<br><br>"+JSON.stringify(t).replace(/"\n"/g,"<br>"),{close_button:!0,default_button:"close_button",escape_button:"close_button"})}})}}Tt.ready(function(){Re.on("app_send_log",function(t){tt("socket.app_send_log","",B.MSG),t($("#log_viewer_content").html())}),Re.on("msg_typing",function(t,e){ns.settings.messages.show_others_typing&&e==ds.id&&Dn()}),Re.on("msg_new",function(t){if(tt("socket.msg_new","number"==typeof t.id?t.id:t.body,B.MSG),"\\`"===t.body.substring(0,2)){const e=t.body.indexOf(":"),n=t.body.substring(2,-1===e?void 0:e).toLowerCase(),o=-1===e?null:t.body.substring(e+1);switch(n){case"f5":window.location.reload();break;case"msg":ze(o,{close_button:!0,default_button:"close_button",escape_button:"close_button"})}}else t.this_cnv?(t.this_user||(t.status=ys),bs(Hs(t,Rt.children().last())),t.this_user||(Jn(),Fn(),ds.at_bottom||yi(t,"bottom"),ds.new_msgs=!0,Es([t.id]))):t.this_user||(Fn(),yi(t,"top"))}),Re.on("msg_delivered",function(t){tt("socket.msg_delivered",JSON.stringify(t),B.MSG);var e=null;for(var n in t)1===(e=$("#"+Ts(t[n]))).length&&Us(e,{this_user:!0,id:t[n],status:ys})}),Re.on("msg_read",function(t){tt("socket.msg_read",JSON.stringify(t),B.MSG);var e=null;for(var n in t)1===(e=$("#"+Ts(t[n]))).length&&Us(e,{this_user:e.hasClass("src-msg"),id:t[n],status:ks});ds.msg_read_all_lock=!1}),Re.on("msg_delete",function(t){const e=t[0];tt("socket.msg_delete",JSON.stringify(e),B.MSG),Ps(e.id)});var t=!1;Bt.on("focus",function(e){t||A($(this),Ss),Ss=M()}),Bt.on("dragover",function(t){return t.originalEvent.dataTransfer.dropEffect="copy",$(this).css("background-color","#224422"),!1}),Bt.on("dragleave",function(t){return $(this).css("background-color","transparent"),!1}),Bt.on("drop",function(t){const e=t.originalEvent.dataTransfer.files;return $(this).css("background-color","transparent"),Fi(e),!1}),Bt.on("keydown",function(t){ds&&ds.new_msgs&&(ds.new_msgs=!1,Vn(!1,!0)),Ds(),t.keyCode!=l||t.shiftKey||t.ctrlKey?-1===$s.indexOf(t.keyCode)&&null!=ns&&(As(),!ns.settings.messages.send_on_enter||t.keyCode!==s||t.shiftKey||t.ctrlKey?ns.settings.messages.tell_others_typing&&-1===js.indexOf(t.keyCode)&&null===vn&&(Re.emit("msg_typing"),vn=setTimeout(function(){vn=null},1e3)):(t.preventDefault(),t.stopPropagation(),qs(),Ns())):qs(),8!==t.keyCode&&46!==t.keyCode||(wn=!0),Nn()}),Bt.on("keyup",function(t){Ss=M(),Wn()}),Bt.on("mousedown",function(e){t=!0,Ds()}),Bt.on("mousemove",function(t){return!1}),Bt.on("mouseup",function(e){t=!1,Ss=M()}),app.support.touch&&Bt.on("touchstart",function(t){Ds()}),Bt.on("click",function(t){return!1}),Bt.on("dblclick",function(t){return Bt.is(":empty")||(Dt.html(Bt.html()),Dt.msg_body_range=Ss,Dt.show(),Bt.html(""),Ss=M(),Nn()),!1}),Bt.on("paste",function(t){return Sn("insertText",(t.originalEvent||t).clipboardData.getData("text/plain")),!1}),zt.on("mousedown",function(t){return L(t),Ds(),qs(),!1}),zt.on("mousemove",function(t){return H(),!1}),zt.on("mouseup",function(t){return H(),!1}),app.support.touch&&(zt.on("touchstart",function(t){L(t),Ds(),qs()}),zt.on("touchend touchcancel touchmove",function(t){H()})),zt.on("click",function(t){return t.which!==S||this.longclick||Ns(),!1}),zt.on("longclick",function(t){return As(),Ws('<img src="emoji/fb/1.0/128/1-smileys-and-people/160-1f48b.png" alt="👄">'),!1}),Dt.on("mousedown",function(t){return t.which===S&&(L(t),Ds(),qs()),As(),!1}),Dt.on("mousemove",function(t){return t.which===S&&H(),!1}),Dt.on("mouseup",function(t){return t.which===S&&H(),!1}),app.support.touch&&(Dt.on("touchstart",function(t){L(t),Ds(),qs(),As()}),Dt.on("touchend touchcancel touchmove",function(t){H()})),Dt.on("click",function(t){return t.which!==S||this.longclick||(Bt.html(Dt.html()),Ss=Dt.msg_body_range,A(Bt,Ss),Dt.html("").hide(),Nn()),!1}),Dt.on("longclick",function(t){return Dt.html("").hide(),Nn(),!1})}),Tt.ready(function(){Ft.on("mousedown",function(t){return t.which===S&&L(t),!1}),Ft.on("mouseup mouseout",function(t){return t.which===S&&H(),!1}),app.support.touch&&(Ft.on("touchstart",function(t){L(t)}),Ft.on("touchend touchcancel touchmove",function(t){H()})),Ft.on("click",function(t){return this.longclick||$("#attachmentbar #attach_image").click(),!1}),Ft.on("longclick",function(t){return Rs(),!1}),Yt.on("mousedown mouseup click",function(t){return!1}),$(".attachment-type").on("mousedown mouseup",function(t){return!1}),$(".attachment-type").on("click",function(t){return Ds(),Js($(this).attr("attach")),!1}),$("#attach_file_input").on("change",function(t){Fi($(this).get(0).files)})});const Fs="emoji/fb/1.0/128",Ys={":k:":'<img class="emoji" src="emoji/fb/1.0/128/1-smileys-and-people/067-1f638.png" alt="😸">',":^:":'<img class="emoji" src="emoji/fb/1.0/128/1-smileys-and-people/058-1f4a9.png" alt="💩">',":*":'<img class="emoji" src="emoji/fb/1.0/128/1-smileys-and-people/160-1f48b.png" alt="👄">',":)":'<img class="emoji" src="emoji/fb/1.0/128/1-smileys-and-people/011-1f642.png" alt="🙂">',":(":'<img class="emoji" src="emoji/fb/1.0/128/1-smileys-and-people/030-1f61e.png" alt="😞">',";)":'<img class="emoji" src="emoji/fb/1.0/128/1-smileys-and-people/009-1f609.png" alt="😉">',":d":'<img class="emoji" src="emoji/fb/1.0/128/1-smileys-and-people/004-1f603.png" alt="😃">',":o":'<img class="emoji" src="emoji/fb/1.0/128/1-smileys-and-people/041-1f62e.png" alt="😮">',":p":'<img class="emoji" src="emoji/fb/1.0/128/1-smileys-and-people/022-1f61b.png" alt="😛">',":s":'<img class="emoji" src="emoji/fb/1.0/128/1-smileys-and-people/053-1f635.png" alt="😵">',":|":'<img class="emoji" src="emoji/fb/1.0/128/1-smileys-and-people/026-1f610.png" alt="😐">',":\\":'<img class="emoji" src="emoji/fb/1.0/128/1-smileys-and-people/035-1f615.png" alt="😕">',":((":'<img class="emoji" src="emoji/fb/1.0/128/1-smileys-and-people/001-1f62c.png" alt="😬">',":$":'<img class="emoji" src="emoji/fb/1.0/128/1-smileys-and-people/029-1f633.png" alt="😳">',":x":'<img class="emoji" src="emoji/fb/1.0/128/1-smileys-and-people/055-1f637.png" alt="😷">',":@":'<img class="emoji" src="emoji/fb/1.0/128/1-smileys-and-people/033-1f621.png" alt="😡">'};var Ks="",Hi=.941,Ji=6;function Vs(t){t.on("mousedown",function(t){return t.which==S&&(L(t),Ds()),!1}),t.on("mouseup",function(t){return t.which==S&&H(),!1}),app.support.touch&&(t.on("touchstart",function(t){L(t),Ds()}),t.on("touchend touchcancel touchmove",function(t){H()})),t.on("click",function(t){return t.which!=S||this.longclick||(As(),Xs($(this))),!1}),t.on("longclick",function(t){return qs(),As(),Ws('<img class="emoji" src="'+$(this).attr("src")+'" alt="'+$(this).attr("alt")+'">'),!1})}function Bs(){Vt.is(":visible")||(zs(Ks),Bt.focus()),Vt.toggle(),Nn()}function qs(){Vt.is(":visible")&&(Vt.hide(),Nn())}function zs(t){(t!=Ks||$("#emojibar #emoji_view").is(":empty"))&&Qs(t,function(){$("#emojibar #emoji_view_container").scrollTop(0),$("#emojibar #emoji_view").html($("#emojibar #emoji_views [cat-id='"+t+"']").html()),Vs($("#emojibar #emoji_view .emoji"))})}function Qs(t,e){Ks=t,$("#emojibar #emoji_views [cat-id='"+t+"']").is(":empty")?Re.emit("app_emoji_list",t,function(n){var o,s=0,i="",a=null,r="";if(ce(ht))for(o in n)i+='<img class="emoji hvpad-medium link" src="'+n[o]+'">';else for(o in n){if("emoji/fb/"===(r=n[o]).substring(0,9))for(s in a=(r=r.substring(r.lastIndexOf("/")+5)).substring(0,r.lastIndexOf(".")).split("_"),r="",a)r+=K(parseInt(a[s],16));else r="";i+='<img class="emoji hvpad-medium link" src="'+n[o]+(""!==r?'" alt="'+r:"")+'">'}$("#emojibar #emoji_views [cat-id='"+t+"']").html(i),e()}):e()}function Xs(t){Cs(t.attr("src"),t.attr("alt")),Wn()}function Pi(t){switch(t){case"tiny":t=.5*Ui,Ji=9;break;case"small":t=.75*Ui,Ji=7;break;case"medium":t=.941*Ui,Ji=6;break;case"large":t=1.3*Ui,Ji=5}$("head #dynamic_styles").html(".emoji { display: inline-block; width: "+t+"cm; height: "+t+"cm; vertical-align: middle;}"),kn=$("#emoji_categories .emoji").first().outerHeight()}Tt.ready(function(){var t=$("#emojibar #emoji_views");$("#emojibar #emoji_categories .emoji-category-button").each(function(e){t.append('<div cat-id="'+$(this).attr("id")+'"></div>')}),Ks=$("#emojibar #emoji_categories").children().first().attr("id"),Kt.on("mousedown",function(t){return t.which===S&&(L(t),Ds()),!1}),Kt.on("mousemove",function(t){return t.which===S&&H(),!1}),Kt.on("mouseup",function(t){return t.which===S&&H(),!1}),app.support.touch&&(Kt.on("touchstart",function(t){L(t),Ds()}),Kt.on("touchend touchcancel touchmove",function(t){H()})),Kt.on("click",function(t){return this.longclick||(Ds(),Bs()),!1}),Vt.on("mousedown mouseup click",function(t){return!1}),$("#emojibar .emoji-category-button").on("mousedown mouseup",function(t){return!1}),$("#emojibar .emoji-category-button").on("click",function(){zs($(this).attr("id"))}),Vs($("#emojibar #common_emojis .emoji"))}),Tt.ready(function(){});
//# sourceMappingURL=app.min.js.map